<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Yuuki 3D – Layered Space</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    #label {
      position: fixed;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      color: #00ffff;
      font-size: 13px;
      opacity: 0.8;
      letter-spacing: 0.1em;
    }
  </style>
</head>
<body>
<div id="label"></div>

<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script>
/* =========================
   Yuuki Theory Parameter
========================= */
// URL ?L=○○ で制御
const params = new URLSearchParams(location.search);
const L = Math.min(Math.max(parseInt(params.get("L")) || 7, 1), 40);

/* =========================
   Scene Setup
========================= */
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, innerWidth / innerHeight, 0.1, 1000);
camera.position.z = 10 + L * 0.4;

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

/* =========================
   Light
========================= */
scene.add(new THREE.AmbientLight(0x66ffff, 0.35));
const light = new THREE.PointLight(0x00ffff, 1.2);
light.position.set(10, 10, 10);
scene.add(light);

/* =========================
   Core
========================= */
const core = new THREE.Mesh(
  new THREE.SphereGeometry(1, 32, 32),
  new THREE.MeshStandardMaterial({
    color: 0x00ffff,
    emissive: 0x008888,
    metalness: 0.6,
    roughness: 0.3
  })
);
scene.add(core);

/* =========================
   Layered Rings (L)
========================= */
const rings = [];

for (let i = 0; i < L; i++) {
  const radius = 2.2 + i * 0.6;
  const ring = new THREE.Mesh(
    new THREE.TorusGeometry(radius, 0.05, 16, 100),
    new THREE.MeshStandardMaterial({
      color: 0x00ffff,
      emissive: 0x002222,
      transparent: true,
      opacity: 0.6 - i / (L * 1.5)
    })
  );

  ring.rotation.x = Math.random() * Math.PI;
  ring.rotation.y = Math.random() * Math.PI;
  rings.push(ring);
  scene.add(ring);
}

/* =========================
   Animation
========================= */
let t = 0;
function animate() {
  requestAnimationFrame(animate);
  t += 0.01;

  // Core breathing
  const s = 1 + 0.04 * Math.sin(t * 2);
  core.scale.set(s, s, s);
  core.rotation.y += 0.01;

  // Layer interference
  rings.forEach((r, i) => {
    r.rotation.x += 0.001 + i * 0.0004;
    r.rotation.y -= 0.0015 + i * 0.0005;
  });

  renderer.render(scene, camera);
}
animate();

/* =========================
   UI
========================= */
document.getElementById("label").textContent =
  `Yuuki Theory | Layer Count L = ${L}`;

/* =========================
   Resize
========================= */
addEventListener("resize", () => {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});
</script>
</body>
</html>
